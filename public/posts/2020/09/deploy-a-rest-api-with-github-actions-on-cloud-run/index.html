<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploy a REST API with Github Actions on Cloud Run | Hassen Taidirt</title>
<meta name=keywords content="Cloud Computing,Software"><meta name=description content="Thanks to Github Actions and Cloud Run, it&rsquo;s easier than ever to deploy Serverless REST APIs to the cloud. This is a step-by-step guide."><meta name=author content="Hassen"><link rel=canonical href=http://localhost:1313/posts/2020/09/deploy-a-rest-api-with-github-actions-on-cloud-run/><meta name=google-site-verification content="G-CBM4L789H1"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/2020/09/deploy-a-rest-api-with-github-actions-on-cloud-run/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/2020/09/deploy-a-rest-api-with-github-actions-on-cloud-run/"><meta property="og:site_name" content="Hassen Taidirt"><meta property="og:title" content="Deploy a REST API with Github Actions on Cloud Run"><meta property="og:description" content="Thanks to Github Actions and Cloud Run, it‚Äôs easier than ever to deploy Serverless REST APIs to the cloud. This is a step-by-step guide."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-22T00:51:25+01:00"><meta property="article:modified_time" content="2020-09-22T00:51:25+01:00"><meta property="article:tag" content="Cloud Computing"><meta property="article:tag" content="Software"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploy a REST API with Github Actions on Cloud Run"><meta name=twitter:description content="Thanks to Github Actions and Cloud Run, it&rsquo;s easier than ever to deploy Serverless REST APIs to the cloud. This is a step-by-step guide."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Deploy a REST API with Github Actions on Cloud Run","item":"http://localhost:1313/posts/2020/09/deploy-a-rest-api-with-github-actions-on-cloud-run/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploy a REST API with Github Actions on Cloud Run","name":"Deploy a REST API with Github Actions on Cloud Run","description":"Thanks to Github Actions and Cloud Run, it\u0026rsquo;s easier than ever to deploy Serverless REST APIs to the cloud. This is a step-by-step guide.","keywords":["Cloud Computing","Software"],"articleBody":"\nHello World,\nI don‚Äôt know if you‚Äôre developing web apps and APIs for long, but it‚Äôs becoming easier than ever to deploy and maintain those solutions thanks to serverless technologies. Recently, GCP launched Cloud Run as a new serverless solution to deploy web applications.\nIn this post we are going to explore Google Cloud Run through a very simple web API. Deployments to Cloud Run will be done through Github Actions triggered after every push to our code base.\nWith all that said, let‚Äôs go!\nüßê First, what is Cloud Run? And why it‚Äôs so amazing? According to Google Cloud, Cloud Run is a:\nFully managed compute platform for deploying and scaling containerized applications quickly and securely.\nIn plain English, Google Cloud Run is a service that lets you easily deploy your Docker container to GCP cloud, and it automatically manages the lifecycle of your containers (provisioning, scaling up and down, and shutdown).\nCloud Run is based on Knative, which is a Kubernetes-based platform to deploy and manage modern serverless workloads.\nThis means that instead of creating and managing your own Kubernetes infrastructure, then install and configure Knative to access the advantages of Serverless applications, you can rely on Cloud Run which does all of this for you.\nContainer based serverless approach is different from Function as a Service serverless approach, in the way that you keep developing the way you and your team are used to. There are ‚Äúfewer‚Äù restrictions on the way you must deliver your code in order for the cloud provider to run it and managed on your behalf. As long as you provide a Docker container that is runnable, and exposes the right port, there is no reason why it can‚Äôt be deployed.\nCloud Run automatically provides a REST endpoint to deployed applications. Incoming requests are sent to the container server through port 8080.\nLike most of serverless solutions, Cloud Run is a pay-per-use service. It also has a generous free tier of 2 million requests free per month. Have a look at the pricing page for more details.\nFor all of this, Cloud Run can be a good solution for you and your team to test your API or app on the cloud without much hassle and expense.\nThe following post will quick start you into Cloud Run by creating a simple Hello World API, and setup for a basic CI/CD pipeline to automate your deployments.\nüó∫ Battle plan The reason I wanted to go this way, instead of deploying using clicks and checks on Cloud Run UI, is that it describes how we really deploy web apps in the real world. This is not just a quick and dirty approach to deploying web applications, but a sustainable, yet still simple, approach to deploy production grade web applications.\nYour local application, Github and Google Cloud Platform all communicate using the following schema:\nYou‚Äôre going to first create the API on your local machine. Once happy with the result, you push your changes to Github which triggers a Github Action to build the image to Google Cloud Registry. When done, Action will create a Cloud Run app and gives it the image location on the registry. Cloud run will start a container with the API then setup an endpoint to access it.\nThis is a very basic CI/CD pipeline. Of course, there is a ton to say about DevOps, but for simplicity sake, we‚Äôre going to keep it simple using the schematized process.\nBut first, we will need to do some setups on GCP and Github. Note that you need to do this only a once (or few couple of times) in the lifetime of your app.\n‚òÅÔ∏è Setup GCP Google Cloud offers $300 of free credits for new subscriptions, within the first year. If you don‚Äôt already have a GCP account, you can create a new one here.\nGoogle Cloud is organized in projects, so the first thing to do is create a new project.\nCreate new project Login to your GCP console, and create a new project.\nAt the end, note the Project ID; You‚Äôll need it to create a secret containing its value. To access Cloud Run, you can list services through the top-left menu, or using the ‚ÄúSearch products and resources‚Äù nav search.\nCreate a service account for Github Actions Because we need to allow Google Actions to build the artifact, and deploy on Cloud Run, we have to grant access and rights to some GCP services for Github.\nIn the top search bar, search for ‚ÄúService Account‚Äù. This is the interface in which we create roles and grant authorizations.\nCreate a new service account for Github Actions:\nA service account is equivalent of a user. In our case we created a user named ‚ÄúGithub Actions‚Äù and we‚Äôre going to give information of that user to Github to properly setup Actions.\nYou next need to give this user rights to do stuff on your behalf. Give your Github Actions the following roles:\nService Account User: This allows Github Actions to run the operations as the service account. Cloud Build Editor: We need to allow Github Actions to create and delete builds. Cloud Run Admin: This gives full control over Cloud Run resources. Viewer: Gives Github Actions read access to all resources. From a security perspective, it‚Äôs very important to restrict, as much as possible, accesses and authorizations for the services we are using.\nIn the next step we can generate and download a key to give Github Actions to authenticate to GCP. Create a new key of type JSON. Once created you‚Äôll start downloading the key locally. **Keep it safe and do not share it publicly, or anyone can create builds and Cloud Run deploys.\nOnce done, you‚Äôll see your new service account on the dashboard. In addition to the downloaded file, you‚Äôll need to copy the email and key ID of your new services accounts for the pipeline.\nThat‚Äôs all for GCP setup. Time to give Github the necessary information to interact with GCP.\nüïπ Setup Github Actions I‚Äôll not explain how to create a new repo and push the codebase on it ;) Once done, head to ‚ÄúSettings‚Äù, then to ‚ÄúSecrets‚Äù section to create a ‚ÄúNew secret‚Äù.\nOur pipeline needs the following 2 secrets:\nName Value to give RUN_PROJECT The Project ID your created RUN_SA_KEY The Base64 encoded content of your downloaded key To get the Base64 encoded key, run the following bash command:\ncat /path/to/your-downloaded-key.json | base64 Copy the content of that result as the value of RUN_SA_KEY.\nNow that we setup both GCP and Github, it‚Äôs time to get our hands dirty with some code.\nüõ† Create a basic API with ExpressJS First things first, let‚Äôs create a basic REST API with ExpressJS framework. It all starts with initializing a NodeJS app.\nmkdir hello-cloud-run cd hello-cloud-run npm init -y We next install ExpressJS package with npm install --save express. This produces the following package.json file:\n{ \"name\": \"hello-cloud-run\", \"version\": \"1.0.0\", \"description\": \"\", \"main\": \"index.js\", \"scripts\": { \"test\": \"echo \\\"Error: no test specified\\\" \u0026\u0026 exit 1\", \"start\": \"node index.js\" }, \"keywords\": [], \"author\": \"\", \"license\": \"ISC\", \"dependencies\": { \"express\": \"^4.17.1\" } } The only difference with your result, is that I manually added line 8 to ask npm start to run node index.js. This means our web server should be in index.js file. Let‚Äôs create a basic HTTP server in it:\nconst express = require(\"express\"); const app = express(); const PORT = process.env.PORT || 8080; app.get(\"/\", (req, res) =\u003e { res.json({ message: \"Hello World!\" }); }); app.listen(PORT, () =\u003e { console.log(\"Listening on port\", PORT); }); This should be obvious. We create a web server that listens on port 8080 (if not specified in the environment) and exposes only one GET route that answers ‚ÄúHello World!‚Äù.\nA simple npm start should to the start. You can check it works by visiting localhost:8080 using your browser or curl.\nNow is time to dockerize our application.\nüê≥ Dockerize the app and test locally Create a Dockerfile file with the following content:\nFROM node:12-slim WORKDIR /app COPY package*.json ./ RUN npm install --only=production COPY . ./ EXPOSE 8080 CMD [ \"npm\", \"start\" ] Our application image starts with a lightweight Docker image of Node 12.\nControlling the size of our application image is important. This is because Cloud Run will first need to pull it before launching our server. The heavier the image, the longer it takes to cold start the server.\nThe remaining Dockerfile lines are straight forward: We define a working directory, copy only package files to install them in the container, copy the remaining files and finally start the server.\nUsually, you don‚Äôt want to copy all the local files of your project in the container. Ignore some files by creating a .docker-ignore file:\nnode_modules/ Dockerfile **/*.log We can now build our Docker image and gie it a tag hello-cloud-run:\ndocker build -t hello-cloud-run And run our container (note the --rm which automatically deletes the Docker container after exiting it):\ndocker run --rm -p 8080:8080 hello-cloud-run Again, visiting your browser at localhost:8080 should prove it works.\n‚öôÔ∏è Create Github Actions yaml file to build the app Now that we have a working REST API, let‚Äôs create the pipeline that will build and ship it to Cloud Run. This process must be done in a yaml file and respect Github Actions syntax and requirements.\nThe folks at Google Cloud already created an example of a Github Action creating a Cloud Run service. You can copy/paste their example and tweak according to your needs. That‚Äôs what I did in the example below, which I saved in .github/workflows/cloud-run.yml file:\nname: Build and Deploy to Cloud Run on: push: branches: - master env: PROJECT_ID: ${{ secrets.RUN_PROJECT }} RUN_REGION: us-central1 SERVICE_NAME: hello-cloud-run jobs: setup-build-deploy: name: Setup, Build, and Deploy to Cloud Run runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v2 # Setup gcloud CLI - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master with: version: \"290.0.1\" service_account_key: ${{ secrets.RUN_SA_KEY }} project_id: ${{ secrets.RUN_PROJECT }} # Build and push image to Google Container Registry - name: Build run: |- gcloud builds submit \\ --quiet \\ --tag \"gcr.io/$PROJECT_ID/$SERVICE_NAME:$GITHUB_SHA\" # Deploy image to Cloud Run - name: Deploy run: |- gcloud run deploy \"$SERVICE_NAME\" \\ --quiet \\ --region \"$RUN_REGION\" \\ --image \"gcr.io/$PROJECT_ID/$SERVICE_NAME:$GITHUB_SHA\" \\ --platform \"managed\" \\ --allow-unauthenticated We first start by naming our workflow and defining its trigger condition (in this case, any new push to master branch). The reason is because we can create many workflows that trigger independently given some conditions. Those workflows are other yaml files stored in .github/workflows/ folder.\nWe next define some environment variables. Those will be referenced later in the jobs section, but first notice the use of ${{ secrets.RUN_PROJECT }} on line 9; Here we are using Github secrets feature to send the pipeline some sensitive variables, like the project id in this case. We will use secrets later in the yaml file to give the job our Google Service Account key.\nThen we finally execute the steps. On a ubuntu-latest machine, we first checkout/get our codebase (on lines 19 and 20), and setup gcloud (from line 23 to 27). gcloud is Google Cloud‚Äôs CLI which we will use to build and deploy our app. It means we need first to install it on our Action ubuntu-latest machine before processing.\nFor that, we use the uses yaml attribute which points to a Github repo and folder GoogleCloudPlatform/github-actions and branch master. Think of it like a plugin that install all what is necessary to deal with GCP.\nNext step is to build the docker image and push it to GCR: Google Cloud Registry. We can do the same building locally and pushing to GCR but using gcloud builds submit will do all what is necessary to ensure it works (including using the right settings). Note that we are using Cloud Build service to build and deposit the artifact in GCR.\nNote that the docker image we use is the one specified in the environment variables, and the tag is Github SHA of our commit. $GITHUB_SHA is an environment variable that was added automatically to Action and there are many more.\nThe final step is to deploy our app to Cloud Run. Again, we are using gcloud CLI to achieve that (from line 37 to 44). The noticeable things are:\nWe provided the image location using --image parameter. This is the location we build our image onto in the previous step. We used --platform \"managed\" to tell Cloud Run to manage the app on our behalf. We added --allow-unauthenticated to allow all requests to our app without authentication. This is best for public APIs and apps. I encourage you to skim the doc if I went too quick on something. There‚Äôs a ton to learn!\nüöÄ To the moon Once you finish creating the pipeline, it‚Äôs time to commit your changes. When you push your work to your Github repo, this will automatically trigger Github Action pipeline for you üéâ\nNota: You might experience the following error on the build process when running jobs for the first time:\nERROR: (gcloud.builds.submit) User [github-actions@***.iam.gserviceaccount.com] does not have permission to access project [***] (or it may not exist): Cloud Build API has not been used in project 1234567890 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/cloudbuild.googleapis.com/overview?project=1234567890 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. Follow the provided link to activate Cloud Build service. This ensures you know what you‚Äôre doing when using a GCP service; You‚Äôll encounter this often when using new GCP services. It has to be done only once.\nRe-run the failed job:\nThe next run should be successful. Deployment to Cloud Run should output the URL of your service:\nVisiting this page should output the same output as shown running it locally:\nWith one small difference‚Ä¶ Note we‚Äôre not using port 8080 when running on Cloud Run. This is because Cloud Run always map the public port 80 of your app to the port 8080 of your container. That‚Äôs why it was important to make our server listening to port 8080 and expose it from Docker through this port.\nNote that Cloud Run will not change the provided URL after updates. This will ensure you get the same test URL when making changes to your code base.\nOne missing last step is to map the provided Cloud Run URL to a fixed domain name. This will be the subject of a future post.\nGoing to the GCP console of Cloud Run will show your deployment live with some metrics:\nYou can have many useful information about how your service is doing, including a handy logging interface. But the interesting tab for you now is YAML tab. Here you can see how your Cloud Run service translates into Knative service. If you want one day to have your own Kubernetes cluster with Knative, you can find good inspiration on how things were doing in the background of Cloud Run.\nCloud Run is just a managed Kubernetes cluster with Knative enabled.\nüëã Final words This was a long project, but hopefully it gives you some idea on how to structure and automate a real project. Github Actions is a very simple CI/CD solution to create and manage simple pipelines. It also integrates very well with Github ecosystem and has a growing community of developers that create and maintain plugins.\nOn the other hand, GCP Cloud Run is a very simple way to create web applications and services, thus allowing you to quickly demonstrate your work, and deploy your solution with minimal cost.\nI hope you enjoyed this post as much as I enjoyed writing it. I really would like to have your feedbacks on the topics mentioned here, or how you are going to use Cloud Run for your projects.\nCheers,\nHassen\n","wordCount":"2648","inLanguage":"en","datePublished":"2020-09-22T00:51:25+01:00","dateModified":"2020-09-22T00:51:25+01:00","author":{"@type":"Person","name":"Hassen"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/2020/09/deploy-a-rest-api-with-github-actions-on-cloud-run/"},"publisher":{"@type":"Organization","name":"Hassen Taidirt","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Hassen (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Hassen</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;¬ª&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Deploy a REST API with Github Actions on Cloud Run</h1><div class=post-meta><span title='2020-09-22 00:51:25 +0100 +0100'>September 22, 2020</span>&nbsp;¬∑&nbsp;13 min&nbsp;¬∑&nbsp;2648 words&nbsp;¬∑&nbsp;Hassen&nbsp;|&nbsp;<a href=https://github.com/HassenIO/hassen.io/posts/2020/09/deploy-a-rest-api-with-github-actions-on-cloud-run.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p><img alt="A ship in the sea" loading=lazy src=/2020/09/hero-ship.jpg title="A ship in the sea"></p><p>Hello World,</p><p>I don&rsquo;t know if you&rsquo;re developing web apps and APIs for long, but it&rsquo;s becoming easier than ever to deploy and maintain those solutions thanks to serverless technologies. Recently, GCP launched Cloud Run as a new serverless solution to deploy web applications.</p><p>In this post we are going to explore Google Cloud Run through a very simple web API. Deployments to Cloud Run will be done through Github Actions triggered after every push to our code base.</p><p>With all that said, let&rsquo;s go!</p><hr><h2 id=-first-what-is-cloud-run-and-why-its-so-amazing>üßê First, what is Cloud Run? And why it&rsquo;s so amazing?<a hidden class=anchor aria-hidden=true href=#-first-what-is-cloud-run-and-why-its-so-amazing>#</a></h2><p>According to <a href=https://cloud.google.com/run>Google Cloud</a>, Cloud Run is a:</p><blockquote><p>Fully managed compute platform for deploying and scaling containerized applications quickly and securely.</p></blockquote><p>In plain English, Google Cloud Run is a service that lets you easily deploy your Docker container to GCP cloud, and it automatically manages the lifecycle of your containers (provisioning, scaling up and down, and shutdown).</p><p>Cloud Run is based on <a href=https://knative.dev/>Knative</a>, which is a Kubernetes-based platform to deploy and manage modern serverless workloads.</p><p>This means that instead of creating and managing your own Kubernetes infrastructure, then install and configure Knative to access the advantages of Serverless applications, you can rely on Cloud Run which does all of this for you.</p><p>Container based serverless approach is different from Function as a Service serverless approach, in the way that you keep developing the way you and your team are used to. There are &ldquo;fewer&rdquo; restrictions on the way you must deliver your code in order for the cloud provider to run it and managed on your behalf. As long as you provide a Docker container that is runnable, and exposes the right port, there is no reason why it can&rsquo;t be deployed.</p><p>Cloud Run automatically provides a REST endpoint to deployed applications. Incoming requests are sent to the container server through port 8080.</p><p>Like most of serverless solutions, Cloud Run is a pay-per-use service. It also has a generous free tier of 2 million requests free per month. Have a look at the <a href=https://cloud.google.com/run/pricing>pricing page</a> for more details.</p><p>For all of this, Cloud Run can be a good solution for you and your team to test your API or app on the cloud without much hassle and expense.</p><p>The following post will quick start you into Cloud Run by creating a simple Hello World API, and setup for a basic CI/CD pipeline to automate your deployments.</p><h2 id=-battle-plan>üó∫ Battle plan<a hidden class=anchor aria-hidden=true href=#-battle-plan>#</a></h2><p>The reason I wanted to go this way, instead of deploying using clicks and checks on Cloud Run UI, is that it describes how we really deploy web apps in the real world. This is not just a quick and dirty approach to deploying web applications, but a sustainable, yet still simple, approach to deploy production grade web applications.</p><p>Your local application, Github and Google Cloud Platform all communicate using the following schema:</p><p><img alt="Schema of our battle plan" loading=lazy src=/2020/09/battle-plan-schema.png></p><p>You&rsquo;re going to first create the API on your local machine. Once happy with the result, you push your changes to Github which triggers a Github Action to build the image to Google Cloud Registry. When done, Action will create a Cloud Run app and gives it the image location on the registry. Cloud run will start a container with the API then setup an endpoint to access it.</p><p>This is a very basic CI/CD pipeline. Of course, there is a ton to say about DevOps, but for simplicity sake, we&rsquo;re going to keep it simple using the schematized process.</p><p>But first, we will need to do some setups on GCP and Github. Note that you need to do this only a once (or few couple of times) in the lifetime of your app.</p><h2 id=-setup-gcp>‚òÅÔ∏è Setup GCP<a hidden class=anchor aria-hidden=true href=#-setup-gcp>#</a></h2><p>Google Cloud offers $300 of free credits for new subscriptions, within the first year. If you don&rsquo;t already have a GCP account, you can create a new one here.</p><p>Google Cloud is organized in projects, so the first thing to do is create a new project.</p><h3 id=create-new-project>Create new project<a hidden class=anchor aria-hidden=true href=#create-new-project>#</a></h3><p>Login to your <a href=https://console.cloud.google.com/>GCP console</a>, and create a new project.</p><p><img alt="New project on GCP" loading=lazy src=/2020/09/gcp-setup-step-01.png></p><p>At the end, note the <strong>Project ID</strong>; You&rsquo;ll need it to create a secret containing its value. To access Cloud Run, you can list services through the top-left menu, or using the &ldquo;Search products and resources&rdquo; nav search.</p><p><img alt="Access Cloud Run" loading=lazy src=/2020/09/gcp-setup-step-02.png></p><h3 id=create-a-service-account-for-github-actions>Create a service account for Github Actions<a hidden class=anchor aria-hidden=true href=#create-a-service-account-for-github-actions>#</a></h3><p>Because we need to allow Google Actions to build the artifact, and deploy on Cloud Run, we have to grant access and rights to some GCP services for Github.</p><p>In the top search bar, search for &ldquo;Service Account&rdquo;. This is the interface in which we create roles and grant authorizations.</p><p><img alt="Access Service Account" loading=lazy src=/2020/09/gcp-setup-step-03.png></p><p>Create a new service account for Github Actions:</p><p><img alt="Create new Service Account" loading=lazy src=/2020/09/gcp-setup-step-04.png></p><p>A service account is equivalent of a user. In our case we created a user named &ldquo;Github Actions&rdquo; and we&rsquo;re going to give information of that user to Github to properly setup Actions.</p><p>You next need to give this user rights to do stuff on your behalf. Give your Github Actions the following roles:</p><ul><li>Service Account User: This allows Github Actions to run the operations as the service account.</li><li>Cloud Build Editor: We need to allow Github Actions to create and delete builds.</li><li>Cloud Run Admin: This gives full control over Cloud Run resources.</li><li>Viewer: Gives Github Actions read access to all resources.</li></ul><blockquote><p>From a security perspective, it&rsquo;s very important to restrict, as much as possible, accesses and authorizations for the services we are using.</p></blockquote><p><img alt="Github Actions service account roles" loading=lazy src=/2020/09/gcp-setup-step-05.png></p><p>In the next step we can generate and download a key to give Github Actions to authenticate to GCP. Create a new key of type JSON. Once created you&rsquo;ll start downloading the key locally. **Keep it safe and do not share it publicly, or anyone can create builds and Cloud Run deploys.</p><p><img alt="Service Account new Key" loading=lazy src=/2020/09/gcp-setup-step-06.png></p><p>Once done, you&rsquo;ll see your new service account on the dashboard. In addition to the downloaded file, you&rsquo;ll need to copy the email and key ID of your new services accounts for the pipeline.</p><p><img alt="Dashboard Service Account" loading=lazy src=/2020/09/gcp-setup-step-07.png></p><p>That&rsquo;s all for GCP setup. Time to give Github the necessary information to interact with GCP.</p><h2 id=-setup-github-actions>üïπ Setup Github Actions<a hidden class=anchor aria-hidden=true href=#-setup-github-actions>#</a></h2><p>I&rsquo;ll not explain how to create a new repo and push the codebase on it ;) Once done, head to &ldquo;Settings&rdquo;, then to &ldquo;Secrets&rdquo; section to create a &ldquo;New secret&rdquo;.</p><p><img alt="Steps to create secrets on Github Actions" loading=lazy src=/2020/09/github-setup-step-01.png></p><p>Our pipeline needs the following 2 secrets:</p><table><thead><tr><th>Name</th><th>Value to give</th></tr></thead><tbody><tr><td><code>RUN_PROJECT</code></td><td>The Project ID your created</td></tr><tr><td><code>RUN_SA_KEY</code></td><td>The Base64 encoded content of your downloaded key</td></tr></tbody></table><p>To get the Base64 encoded key, run the following bash command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /path/to/your-downloaded-key.json <span class=p>|</span> base64
</span></span></code></pre></div><p>Copy the content of that result as the value of <code>RUN_SA_KEY</code>.</p><p><img alt="Added secrets to Github" loading=lazy src=/2020/09/github-setup-step-02.png></p><p>Now that we setup both GCP and Github, it&rsquo;s time to get our hands dirty with some code.</p><h2 id=-create-a-basic-api-with-expressjs>üõ† Create a basic API with ExpressJS<a hidden class=anchor aria-hidden=true href=#-create-a-basic-api-with-expressjs>#</a></h2><p>First things first, let&rsquo;s create a basic REST API with ExpressJS framework. It all starts with initializing a NodeJS app.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir hello-cloud-run
</span></span><span class=line><span class=cl><span class=nb>cd</span> hello-cloud-run
</span></span><span class=line><span class=cl>npm init -y
</span></span></code></pre></div><p>We next install ExpressJS package with <code>npm install --save express</code>. This produces the following <strong>package.json</strong> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;hello-cloud-run&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;main&#34;</span><span class=p>:</span> <span class=s2>&#34;index.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node index.js&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;keywords&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;author&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;license&#34;</span><span class=p>:</span> <span class=s2>&#34;ISC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;^4.17.1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The only difference with your result, is that I manually added line 8 to ask <code>npm start</code> to run <code>node index.js</code>. This means our web server should be in <strong>index.js</strong> file. Let&rsquo;s create a basic HTTP server in it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;express&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>PORT</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=mi>8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s2>&#34;Hello World!&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Listening on port&#34;</span><span class=p>,</span> <span class=nx>PORT</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>This should be obvious. We create a web server that listens on port 8080 (if not specified in the environment) and exposes only one <em>GET</em> route that answers &ldquo;Hello World!&rdquo;.</p><p>A simple <code>npm start</code> should to the start. You can check it works by visiting <em>localhost:8080</em> using your browser or <code>curl</code>.</p><p>Now is time to dockerize our application.</p><h2 id=-dockerize-the-app-and-test-locally>üê≥ Dockerize the app and test locally<a hidden class=anchor aria-hidden=true href=#-dockerize-the-app-and-test-locally>#</a></h2><p>Create a <strong>Dockerfile</strong> file with the following content:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> node:12-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm install --only<span class=o>=</span>production<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span> <span class=s2>&#34;npm&#34;</span><span class=p>,</span> <span class=s2>&#34;start&#34;</span> <span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>Our application image starts with a lightweight Docker image of Node 12.</p><blockquote><p>Controlling the size of our application image is important. This is because Cloud Run will first need to pull it before launching our server. The heavier the image, the longer it takes to cold start the server.</p></blockquote><p>The remaining Dockerfile lines are straight forward: We define a working directory, copy only package files to install them in the container, copy the remaining files and finally start the server.</p><p>Usually, you don&rsquo;t want to copy all the local files of your project in the container. Ignore some files by creating a <strong>.docker-ignore</strong> file:</p><pre tabindex=0><code>node_modules/
Dockerfile
**/*.log
</code></pre><p>We can now build our Docker image and gie it a tag <em>hello-cloud-run</em>:</p><pre tabindex=0><code>docker build -t hello-cloud-run
</code></pre><p>And run our container (note the <code>--rm</code> which automatically deletes the Docker container after exiting it):</p><pre tabindex=0><code>docker run --rm -p 8080:8080 hello-cloud-run
</code></pre><p>Again, visiting your browser at <em>localhost:8080</em> should prove it works.</p><p><img alt="Hello World from Docker container" loading=lazy src=/2020/09/hello-world-local.png></p><h2 id=-create-github-actions-yaml-file-to-build-the-app>‚öôÔ∏è Create Github Actions yaml file to build the app<a hidden class=anchor aria-hidden=true href=#-create-github-actions-yaml-file-to-build-the-app>#</a></h2><p>Now that we have a working REST API, let&rsquo;s create the pipeline that will build and ship it to Cloud Run. This process must be done in a yaml file and respect Github Actions syntax and requirements.</p><p>The folks at Google Cloud already created an example of a Github Action creating a Cloud Run service. You can copy/paste their example and tweak according to your needs. That&rsquo;s what I did in the example below, which I saved in <strong>.github/workflows/cloud-run.yml</strong> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build and Deploy to Cloud Run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PROJECT_ID</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.RUN_PROJECT }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>RUN_REGION</span><span class=p>:</span><span class=w> </span><span class=l>us-central1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>SERVICE_NAME</span><span class=p>:</span><span class=w> </span><span class=l>hello-cloud-run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>setup-build-deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup, Build, and Deploy to Cloud Run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Setup gcloud CLI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>GoogleCloudPlatform/github-actions/setup-gcloud@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;290.0.1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>service_account_key</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.RUN_SA_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>project_id</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.RUN_PROJECT }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Build and push image to Google Container Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          gcloud builds submit \
</span></span></span><span class=line><span class=cl><span class=sd>            --quiet \
</span></span></span><span class=line><span class=cl><span class=sd>            --tag &#34;gcr.io/$PROJECT_ID/$SERVICE_NAME:$GITHUB_SHA&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Deploy image to Cloud Run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          gcloud run deploy &#34;$SERVICE_NAME&#34; \
</span></span></span><span class=line><span class=cl><span class=sd>            --quiet \
</span></span></span><span class=line><span class=cl><span class=sd>            --region &#34;$RUN_REGION&#34; \
</span></span></span><span class=line><span class=cl><span class=sd>            --image &#34;gcr.io/$PROJECT_ID/$SERVICE_NAME:$GITHUB_SHA&#34; \
</span></span></span><span class=line><span class=cl><span class=sd>            --platform &#34;managed&#34; \
</span></span></span><span class=line><span class=cl><span class=sd>            --allow-unauthenticated</span><span class=w>
</span></span></span></code></pre></div><p>We first start by naming our workflow and defining its trigger condition (in this case, any new push to master branch). The reason is because we can create many workflows that trigger independently given some conditions. Those workflows are other yaml files stored in <strong>.github/workflows/</strong> folder.</p><p>We next define some environment variables. Those will be referenced later in the <em>jobs</em> section, but first notice the use of <code>${{ secrets.RUN_PROJECT }}</code> on line 9; Here we are using Github secrets feature to send the pipeline some sensitive variables, like the project id in this case. We will use secrets later in the yaml file to give the job our Google Service Account key.</p><p>Then we finally execute the steps. On a <code>ubuntu-latest</code> machine, we first checkout/get our codebase (on lines 19 and 20), and setup <code>gcloud</code> (from line 23 to 27). <code>gcloud</code> is Google Cloud&rsquo;s CLI which we will use to build and deploy our app. It means we need first to install it on our Action <code>ubuntu-latest</code> machine before processing.</p><p>For that, we use the <code>uses</code> yaml attribute which points to a Github repo and folder <a href=https://https://github.com/GoogleCloudPlatform/github-actions/tree/master/setup-gcloud><code>GoogleCloudPlatform/github-actions</code></a> and branch <code>master</code>. Think of it like a plugin that install all what is necessary to deal with GCP.</p><p>Next step is to build the docker image and push it to GCR: Google Cloud Registry. We can do the same building locally and pushing to GCR but using <code>gcloud builds submit</code> will do all what is necessary to ensure it works (including using the right settings). <strong>Note that we are using Cloud Build service to build and deposit the artifact in GCR.</strong></p><p>Note that the docker image we use is the one specified in the environment variables, and the tag is Github SHA of our commit. <code>$GITHUB_SHA</code> is an environment variable that was added automatically to Action and <a href=https://help.github.com/en/actions/configuring-and-managing-workflows/using-environment-variables>there are many more</a>.</p><p>The final step is to deploy our app to Cloud Run. Again, we are using <code>gcloud</code> CLI to achieve that (from line 37 to 44). The noticeable things are:</p><ul><li>We provided the image location using <code>--image</code> parameter. This is the location we build our image onto in the previous step.</li><li>We used <code>--platform "managed"</code> to tell Cloud Run to manage the app on our behalf.</li><li>We added <code>--allow-unauthenticated</code> to allow all requests to our app without authentication. This is best for public APIs and apps.</li></ul><p>I encourage you to <a href=https://help.github.com/en/actions>skim the doc</a> if I went too quick on something. There&rsquo;s a ton to learn!</p><h2 id=-to-the-moon>üöÄ To the moon<a hidden class=anchor aria-hidden=true href=#-to-the-moon>#</a></h2><p>Once you finish creating the pipeline, it&rsquo;s time to commit your changes. When you push your work to your Github repo, this will automatically trigger Github Action pipeline for you üéâ</p><p><em>Nota: You might experience the following error on the build process when running jobs for the first time:</em></p><pre tabindex=0><code>ERROR: (gcloud.builds.submit) User [github-actions@***.iam.gserviceaccount.com] does not have permission to access project [***] (or it may not exist): Cloud Build API has not been used in project 1234567890 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/cloudbuild.googleapis.com/overview?project=1234567890 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.
</code></pre><p><em>Follow the provided link to activate Cloud Build service. This ensures you know what you&rsquo;re doing when using a GCP service; You&rsquo;ll encounter this often when using new GCP services. It has to be done only once.</em></p><p><em>Re-run the failed job:</em></p><p><img alt="Added secrets to Github" loading=lazy src=/2020/09/github-setup-step-03.png></p><p>The next run should be successful. Deployment to Cloud Run should output the URL of your service:</p><p><img alt="Get Service URL" loading=lazy src=/2020/09/github-run-step-01.png></p><p>Visiting this page should output the same output as shown running it locally:</p><p><img alt="Online test of Cloud Run deployment" loading=lazy src=/2020/09/cloud-run-service.png></p><p>With one small difference&mldr; Note we&rsquo;re not using port <code>8080</code> when running on Cloud Run. This is because Cloud Run always map the public port <code>80</code> of your app to the port <code>8080</code> of your container. That&rsquo;s why it was important to make our server listening to port <code>8080</code> and expose it from Docker through this port.</p><p>Note that Cloud Run will not change the provided URL after updates. This will ensure you get the same test URL when making changes to your code base.</p><p>One missing last step is to map the provided Cloud Run URL to a fixed domain name. This will be the subject of a future post.</p><p>Going to the GCP console of Cloud Run will show your deployment live with some metrics:</p><p><img alt="Cloud Run console on GCP with metrics" loading=lazy src=/2020/09/cloud-run-console-01.png></p><p>You can have many useful information about how your service is doing, including a handy logging interface. But the interesting tab for you now is <strong>YAML</strong> tab. Here you can see how your Cloud Run service translates into Knative service. If you want one day to have your own Kubernetes cluster with Knative, you can find good inspiration on how things were doing in the background of Cloud Run.</p><p><img alt="Cloud Run service in YAML" loading=lazy src=/2020/09/cloud-run-console-02.png></p><blockquote><p>Cloud Run is just a managed Kubernetes cluster with Knative enabled.</p></blockquote><hr><h2 id=-final-words>üëã Final words<a hidden class=anchor aria-hidden=true href=#-final-words>#</a></h2><p>This was a long project, but hopefully it gives you some idea on how to structure and automate a real project. Github Actions is a very simple CI/CD solution to create and manage simple pipelines. It also integrates very well with Github ecosystem and has a growing community of developers that create and maintain plugins.</p><p>On the other hand, GCP Cloud Run is a very simple way to create web applications and services, thus allowing you to quickly demonstrate your work, and deploy your solution with minimal cost.</p><p>I hope you enjoyed this post as much as I enjoyed writing it. I really would like to have your feedbacks on the topics mentioned here, or how you are going to use Cloud Run for your projects.</p><p>Cheers,</p><p>Hassen</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/cloud-computing/>Cloud Computing</a></li><li><a href=http://localhost:1313/tags/software/>Software</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/2022/02/iterm2-quick-move/><span class=title>¬´ Prev</span><br><span>iTerm2 tips, Episode 1: Jump forward and backward words in iTerm2</span>
</a><a class=next href=http://localhost:1313/posts/2020/04/demystifying-google-cloud-iam/><span class=title>Next ¬ª</span><br><span>Demystifying Google Cloud IAM</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy a REST API with Github Actions on Cloud Run on x" href="https://x.com/intent/tweet/?text=Deploy%20a%20REST%20API%20with%20Github%20Actions%20on%20Cloud%20Run&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f&amp;hashtags=CloudComputing%2cSoftware"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy a REST API with Github Actions on Cloud Run on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f&amp;title=Deploy%20a%20REST%20API%20with%20Github%20Actions%20on%20Cloud%20Run&amp;summary=Deploy%20a%20REST%20API%20with%20Github%20Actions%20on%20Cloud%20Run&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy a REST API with Github Actions on Cloud Run on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f&title=Deploy%20a%20REST%20API%20with%20Github%20Actions%20on%20Cloud%20Run"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy a REST API with Github Actions on Cloud Run on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy a REST API with Github Actions on Cloud Run on whatsapp" href="https://api.whatsapp.com/send?text=Deploy%20a%20REST%20API%20with%20Github%20Actions%20on%20Cloud%20Run%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy a REST API with Github Actions on Cloud Run on telegram" href="https://telegram.me/share/url?text=Deploy%20a%20REST%20API%20with%20Github%20Actions%20on%20Cloud%20Run&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy a REST API with Github Actions on Cloud Run on ycombinator" href="https://news.ycombinator.com/submitlink?t=Deploy%20a%20REST%20API%20with%20Github%20Actions%20on%20Cloud%20Run&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2020%2f09%2fdeploy-a-rest-api-with-github-actions-on-cloud-run%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Hassen Taidirt</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>